<html>
<canvas id="tela" width="820" height="700"></canvas>
<meta charset="utf-8">
<div id="score"></div>
<style type="text/css" media="screen">
#tela {
    position: absolute;
    top:  50%;
    left: 50%;
    transform: translate(-50%,-50%);
    outline: black 15px solid;
}
body {
    background-color: rgb(235, 221, 34);
}
#score {
    color: #003366;
    font-family: Gill Sans;
    font-size: 300%;
    position: left;
}
</style>

<script>
    var tela;
    var c;
    var score = 0;

    var canhao;
    var laser;
    //var alien_linha = [];
    var alien_linha1;
    var alien_linha2;
    var alien_linha3;
    var alien_linha4;
    var alien_linha5;

    var canhaoX = 390;
    var canhaoY = 600;
    var laserXcanhao = 410;
    var laserYcanhao = 500;
    var alienX = 0;
    var alienY = 50;
    var inicioLaser = false;
    var impactolaserXcanhao;
    var laserMovendo;
    var velocidadeAlien = 30;
    var posicao = 0;
    var cont = 0;

    var alienLinhas = [7, 97, 187, 277, 367, 457, 547, 637, 727];
    var alienColunas = [35, 85, 135, 185, 235];
    var aliensRestantes = [];

    const C_ALTURA = 700;
    const C_LARGURA = 820;

    const TECLA_ESQUERDA = 37;
    const TECLA_DIREITA = 39;
    const TECLA_ACIMA = 38;

    onkeydown = moverCanhao; // Define função chamada ao se pressionar uma tecla

    iniciar(); // Chama função inicial do jogo


    // Sub-rotinas (funções)
    function iniciar() {
        tela = document.getElementById("tela");
        c = tela.getContext("2d");
        c.fillStyle = "#003366";
        c.fillRect(0, 0, C_LARGURA, C_ALTURA);
        posicionarAlien();
        carregarImagens();


        setInterval("moverAliens()", velocidadeAlien);
        setInterval("alienAtingido()", 6);
    }
    function posicionarAlien() {
        for (var i = 0; i < alienLinhas.length; i++){
            for (var j = 0; j < alienColunas.length; j++){
                var novoAlien = {
                    posX : alienLinhas[i],
                    posY : alienColunas[j],
                    foiAtingido : false
                };
                aliensRestantes[aliensRestantes.length] = novoAlien;
            }
        }
    }

    function carregarImagens() {
        canhao = new Image();
        canhao.src = "canhao.png";
        canhao.onload = function(){
            c.drawImage(canhao, canhaoX, canhaoY);
        }
        
        laser = new Image();
        laser.src = "laser.png";

/*
        for (var i = 0; i < 4; i++) {
            alien_linha[i] = new Image();
            alien_linha[i].src = "alien_linha"+(i+1)+".gif";
        }
    }
*/

        alien_linha1 = new Image();
        alien_linha1.src = "alien_linha1.gif";

        alien_linha2 = new Image();
        alien_linha2.src = "alien_linha2.gif";

        alien_linha3 = new Image();
        alien_linha3.src = "alien_linha3.gif";

        alien_linha4 = new Image();
        alien_linha4.src = "alien_linha4.gif";

        alien_linha5 = new Image();
        alien_linha5.src = "alien_linha5.png";
    }

    function moverAliens(){
            if (posicao <= 65){
                alienX += 1;
                posicao += 2;
            } else if ((posicao > 65) && (posicao <= 80)){
                alienX += 1;
                alienY += 1;
                posicao += 2;            
            } else if ((posicao > 80) && (posicao <= 147)){
                alienX -= 1;
                posicao += 2;
            } else if ((posicao > 147) && (posicao < 162)){
                alienX -= 1;
                alienY += 1;
                posicao += 2;
            } else{
                posicao = 0;
            }
            document.getElementById('score').innerHTML = "SCORE: " + score;
            for (var i = 0; i < aliensRestantes.length; i++){
                if (!aliensRestantes[i].foiAtingido){
                    c.fillRect((alienX + aliensRestantes[i].posX - 1), (alienY + aliensRestantes[i].posY - 1), 34, 34);
                    for (var j =0 ; j<4; j++){
                    // A partir daqui é força bruta
                    if(i==0){
                        c.drawImage(alien_linha1, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[0].posY));
                    }
                    else if(i==1){
                        c.drawImage(alien_linha2, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[1].posY));
                    }
                    else if (i==2){
                        c.drawImage(alien_linha3, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[2].posY));
                    }
                    else if (i==3){
                        c.drawImage(alien_linha4, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[3].posY));
                    }
                    else if (i==4){
                        c.drawImage(alien_linha5, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[4].posY));
                    }
                    else if (i==5){
                        c.drawImage(alien_linha1, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[0].posY));
                    }
                    else if (i==6){
                        c.drawImage(alien_linha2, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[1].posY));
                    }
                    else if (i==7){
                        c.drawImage(alien_linha3, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[2].posY));
                    }
                    else if(i==8){
                        c.drawImage(alien_linha4, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[3].posY));
                    }
                    else if(i==9){
                        c.drawImage(alien_linha5, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[4].posY));
                    }
                    else if (i==10){
                        c.drawImage(alien_linha1, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[0].posY));
                    }
                    else if (i==11){
                        c.drawImage(alien_linha2, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[1].posY));
                    }
                    else if(i==12){
                        c.drawImage(alien_linha3, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[2].posY));
                    }
                    else if(i==13){
                        c.drawImage(alien_linha4, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[3].posY));
                    }
                    else if (i==14){
                        c.drawImage(alien_linha5, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[4].posY));
                    }
                    else if (i==15){
                        c.drawImage(alien_linha1, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[0].posY));
                    }
                    else if(i==16){
                        c.drawImage(alien_linha2, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[1].posY));
                    }
                    else if(i==17){
                        c.drawImage(alien_linha3, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[2].posY));
                    }
                    else if (i==18){
                        c.drawImage(alien_linha4, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[3].posY));
                    }
                    else if (i==19){
                        c.drawImage(alien_linha5, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[4].posY));
                    }
                    else if(i==20){
                        c.drawImage(alien_linha1, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[0].posY));
                    }
                    else if(i==21){
                        c.drawImage(alien_linha2, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[1].posY));
                    }
                    else if (i==22){
                        c.drawImage(alien_linha3, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[2].posY));
                    }
                    else if (i==23){
                        c.drawImage(alien_linha4, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[3].posY));
                    }
                    else if(i==24){
                        c.drawImage(alien_linha5, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[4].posY));
                    }
                    else if(i==25){
                        c.drawImage(alien_linha1, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[0].posY));
                    }
                    else if (i==26){
                        c.drawImage(alien_linha2, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[1].posY));
                    }
                    else if (i==27){
                        c.drawImage(alien_linha3, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[2].posY));
                    }
                    else if(i==28){
                        c.drawImage(alien_linha4, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[3].posY));
                    }
                    else if(i==29){
                        c.drawImage(alien_linha5, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[4].posY));
                    }
                    else if (i==30){
                        c.drawImage(alien_linha1, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[0].posY));
                    }
                    else if (i==31){
                        c.drawImage(alien_linha2, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[1].posY));
                    }
                    else if(i==32){
                        c.drawImage(alien_linha3, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[2].posY));
                    }
                    else if(i==33){
                        c.drawImage(alien_linha4, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[3].posY));
                    }
                    else if (i==34){
                        c.drawImage(alien_linha5, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[4].posY));
                    }
                    else if (i==35){
                        c.drawImage(alien_linha1, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[0].posY));
                    }
                    else if (i==36){
                        c.drawImage(alien_linha2, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[1].posY));
                    }
                    else if (i==37){
                        c.drawImage(alien_linha3, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[2].posY));
                    }
                    else if (i==38){
                        c.drawImage(alien_linha4, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[3].posY));
                    }
                    else if (i==39){
                        c.drawImage(alien_linha5, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[4].posY));
                    }
                    else if (i==40){
                        c.drawImage(alien_linha1, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[0].posY));
                    }
                    else if (i==41){
                        c.drawImage(alien_linha2, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[1].posY));
                    }
                    else if (i==42){
                        c.drawImage(alien_linha3, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[2].posY));
                    }
                    else if (i==43){
                        c.drawImage(alien_linha4, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[3].posY));
                    }
                    else if (i==44){
                        c.drawImage(alien_linha5, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[4].posY));
                    }
                    }
                    c.fillText
                    if ((aliensRestantes[i].posY + alienY + 30) >= 600){
                        fimDeJogo();
                    }
                }
            }
    }
    function alienAtingido(){
        for(var i = 0; i < aliensRestantes.length; i++){
            if ((laserYcanhao >= (alienY + aliensRestantes[i].posY)) && (laserYcanhao <= (alienY + aliensRestantes[i].posY + 34)) && 
                (impactolaserXcanhao >= (alienX + aliensRestantes[i].posX - 5)) && (impactolaserXcanhao <= (alienX + aliensRestantes[i].posX + 30))){
                if (!aliensRestantes[i].foiAtingido){
                    if (i==0||i==5||i==10||i==15||i==20||i==25||i==30||i==35||i==40){
                        score+=30;
                    }
                    else if (i==2||i==7||i==12||i==17||i==22||i==27||i==32||i==37||i==42 || i==1||i==6||i==11||i==16||i==21||i==26||i==31||i==36||i==41){
                        score+=20;
                    }
                    else if (i==4||i==9||i==14||i==19||i==24||i==29||i==34||i==39||i==44|| i==3||i==8||i==13||i==18||i==23||i==28||i==33||i==38||i==43){
                        score+=10;
                    }
                    c.fillStyle = "#003366";
                    c.fillRect((alienX + aliensRestantes[i].posX - 2), (alienY + aliensRestantes[i].posY - 2), 34, 34);
                    aliensRestantes[i].foiAtingido = true;
                    c.fillRect(impactolaserXcanhao, laserYcanhao, 6, 19);
                    laserYcanhao = 0;
                    cont++;
                    if(cont==45){
                        fimDeJogoVitoria();
                    }
                }
            }
        }    
    }

    function fimDeJogo(){
        canhaoX = 180;
        laserXcanhao = 193;
        laserYcanhao = 520;
        alienX = 0;
        alienY = 0;
        posicao = 0;
        aliensRestantes = [];
        inicioLaser = false;
        
        c.fillStyle = "black";
        c.fillRect(0, 0, C_LARGURA, C_ALTURA);
        
        c.textAlign = "center";
        c.font = "40px Impact";
        c.fillStyle = "#68CD7C";
        c.fillText("Fim de Jogo!", C_LARGURA/2, C_ALTURA/2);
        c.fillText("Aperte espaço para reiniciar", C_LARGURA/2, (C_ALTURA/2)+45);
        window.addEventListener("keydown",checkKeyPress, false);
        function checkKeyPress(key){
            if (key.keyCode == "32"){
                location.reload();
            }
        }
        onkeydown = null;
    }

    function fimDeJogoVitoria(){
        canhaoX = 180;
        laserXcanhao = 193;
        laserYcanhao = 520;
        alienX = 0;
        alienY = 0;
        posicao = 0;
        aliensRestantes = [];
        inicioLaser = false;
        
        c.fillStyle = "black";
        c.fillRect(0, 0, C_LARGURA, C_ALTURA);
        
        c.textAlign = "center";
        c.font = "40px Impact";
        c.fillStyle = "#68CD7C";
        c.fillText("Parabéns, você venceu!", C_LARGURA/2, C_ALTURA/2);
        c.fillText("Caso queira jogar novamente,", C_LARGURA/2, (C_ALTURA/2)+90);
        c.fillText("aperte espaço para reiniciar.", C_LARGURA/2, (C_ALTURA/2)+135);
        window.addEventListener("keydown",checkKeyPress, false);
        function checkKeyPress(key){
            if (key.keyCode == "32"){
                location.reload();
            }
        }
        onkeydown = null;
    }

    function moverCanhao(tecla){
        var codigo = tecla.keyCode;
        
        if ((codigo == TECLA_DIREITA) && (canhaoX <= 775)){
            c.fillStyle = "#003366";
            c.fillRect(canhaoX, 600, 40, 40);
            canhaoX += 15;
            laserXcanhao += 15;
            c.drawImage(canhao, canhaoX, canhaoY);
        }
        
        if ((codigo == TECLA_ESQUERDA) && (canhaoX >= 9)){
            c.fillStyle = "#003366";
            c.fillRect(canhaoX, 600, 40, 40);
            canhaoX -= 15;
            laserXcanhao -= 15;
            c.drawImage(canhao, canhaoX, canhaoY);
        }
        
        if ((codigo == TECLA_ACIMA) && !inicioLaser){
            inicioLaser = true;
            c.drawImage(laser, laserXcanhao, laserYcanhao);
            impactolaserXcanhao = laserXcanhao;
            laserMovendo = setInterval("dispararLaser()", 5);
        }
    }

    function dispararLaser(){
        if (inicioLaser && (laserYcanhao >= 60)){
            laserYcanhao -= 10;
            c.fillStyle = "#003366";
            c.fillRect(impactolaserXcanhao, (laserYcanhao+10), 6, 19);
            
            if (laserYcanhao >= 70){
                c.drawImage(laser, impactolaserXcanhao, laserYcanhao);
            }
        }
        
        if (laserYcanhao < 60){
            clearInterval(laserMovendo);
            inicioLaser = false;
            laserYcanhao = 570;
        }
    }
</script>
</html>